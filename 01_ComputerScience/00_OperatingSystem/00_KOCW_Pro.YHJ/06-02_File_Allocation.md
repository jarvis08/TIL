# 6-2. 파일 할당, File Allocation

파일을 블록에 할당하는 방법으로는 세 가지 방법이 있습니다.

- 연속 할당, Continuous Allocation
- 연결 할당, Linked Allocation
- 색인 할당, Indexed Allocation

<br>

<br>

## 6-2-1. 연속 할당, Continuous Allocation

연속 할당은 IBM(VM/CMS)에서 60-70년대에 사용하던 할당 방법입니다. 연속 할당은 파일을 할당하는 가장 단순한 방법으로, **연속된 복수개의 블록들에 파일을 순서대로 저장**합니다.

<br>

### 연속 할당의 장점

연속 할당은 **디스크 헤더(Header)의 이동을 최소화** 할 수 있습니다. 특정 파일을 읽어내고 싶다면 시작 블록으로 이동하여 순차적으로 읽어나가기만 하면 됩니다.

- **순차 접근, Sequential Access**

  파일 하나를 읽기 위해 순차적인 블록 공간을 읽어내기만 하면 된다.

- **직접 접근, Direct Access**

  파일의 중간을 탐색해야 할 때, 특정 지점을 지정하여 그 부분만 읽어낼 수 있다.

<br>

### 연속 할당의 단점

연속 할당은 분명 읽기 속도 면에서 가장 빠른 속도를 낼 수 있습니다. 하지만 파일을 삭제하거나 갱싱할 경우 치명적인 문제가 발생합니다.

파일 삭제 시 파일이 기록되어 있던 블록은 빈 공간(Hole)이 되며, 파일의 생성과 삭제가 반복되면 빈 공간들이 곳곳에 흩어지게 됩니다. 이로 인해 **외부 단편화**라는 큰 문제가 발생합니다. 이를 Compaction 하는 것에도 긴 시간이 걸리며, 파일 삭제가 아니더라도 log file과 같이 **파일에 필요한 공간이 늘어나게 될 시** 이를 처리하는 것도 곤란할 수 있습니다.

<br>

<br>

## 6-2-2. 연결 할당, Linked Allocation

파일을 **연결된 리스트의 블록들로 관리**하며, **파일 디렉토리(File Directory)**는 파일의 **맨 처음 블록**을 가리킵니다. 첫 블록 이후의 블록들은 4 Byte 이상의 (**다음 블록의 포인터**)를 보유합니다.

### 연결 할당의 장점

**외부 단편화가 발생하지 않습니다**. 블록 마다 링크만 연결된다면, 어느 위치이든 파일을 할당할 수 있습니다.

<br>

<br>

### 연결 할당의 단점

**순차 접근(Sequential Access)** 방식입니다. 계속해서 다음 블록의 포인터를 쫒아 파일을 읽어냅니다. 그런데 연결 할당은 다음의 단점들이 있습니다.

- 직접 접근(Direct Access) 불가

- 블록마다 포인터 저장을 위한 4 Byte 공간이 필요

- 낮은 신뢰성

  포인터가 끊어지면, 그 다음 순차의 데이터들에는 접근이 불가

- 느린 속도

  잦은 헤더 이동

<br>

<br>

### 연결 할당의 개선, FAT 파일 시스템

FAT(File Allocation Table) 파일 시스템은 연결 할당의 문제점을 해결 하며, MS-DOS, OS/2, Windows, 대부분의 USB 등에서 다양하게 사용됩니다.

FAT 파일 시스템의 핵심은 **포인터들을 모두 FAT 블록에 모으는 것**입니다. 포인터들을 따로 모아주는 것으로 공간과 속도 모두를 개선할 수 있습니다.

- 신뢰성 보장

  - 링크가 모두 FAT에 모여있기 때문에 끊길 일이 없다.
  - FAT 손실을 대비하여 복구용 FAT를 하나 더 만든다.

- 직접 접근(Direct Access) 가능

- 일반적으로 메모리 캐싱이다.

  거의 메모리에 상주하는 것과 같다. 운영체제 부팅하듯, 로드하여 유지한다.

<br>

<br>

## 6-2-3. 색인 할당, Indexed Allocation

파일 당 하나의 인덱스 블록을 보유합니다. 즉 파일에 여러 데이터 블록(데이터가 기록된 블록)들이 있을 때, 이 블록들을 연결할 수 있도록 데이터 블록들의 인덱스가 기록된 **인덱스 블록**을 따로 생성하여 관리합니다. 즉, 파일 마다 포인터들의 모음인 인덱스 블록을 보유하고 있으며, **파일 디렉토리는 인덱스 블록을 가리킵니다**. Linux/Unix 등에서 사용합니다.

<br>

### 색인 할당의 장점

- 직접 접근(Direct Access) 가능
- 외부 단편화 없음

<br>

### 색인 할당의 단점

인덱스 블록을 할당해야 하기 때문에 저장 공간이 손실됩니다.

하지만 이러한 문제 보다, 하나의 인덱스 공간이 하나의 블록을 사용한다 했을 때, 인덱스 블록이 **많은 내용을 가리킬 수 없는 것이 더 큰 문제**입니다. 이는 다음의 예시를 보고 확인할 수 있습니다.

```
1 블록 = 512 byte = 4 byte * (128개의 인덱스)
:: 128개의 인덱스 * 512 byte = 64 KB
```

즉, 하나의 블록이 512 byte 크기를 갖는다 했을 때, 하나의 인덱스 블록은 최대 64 KB 크기의 파일만을 가리킬 수 있습니다. 만약 블록 크기가 1 KB일 지라도 최대 256 KB의 파일 크기로 제한됩니다.

<br>

### 색인 할당의 보완

- Linked

  인덱스 블록의 포인터들 중 하나가 다른 인덱스 블록을 가리킴

- Multilevel Index

  **인덱스 블록 하나**가 다른 인덱스 블록들을 가리키는, **인덱스 블록들의 인덱스 블록 역할을 수행**

- Combined

  (**Linked + Multilevel Index**)이며, 실제 Linux에서 사용하는 방법





