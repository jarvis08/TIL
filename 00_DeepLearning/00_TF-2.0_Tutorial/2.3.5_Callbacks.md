# 2.3.5 Callbacks

## 콜백(Callback)이란

### 콜백의 정의

콜백 함수의 정의는 다음과 같습니다.

```
어떤 함수에 전달된 후, 그 함수가 실행되는 동안 특정 조건을 충족하면 호출되는 함수
```

텐서플로(TensorFlow)에서의 콜백 또한 크게 다르지 않으며, 다양한 방법으로 학습하는 모델을 모니터링하고 조작할 수 있습니다. 텐서플로에는 콜백 함수를 두 가지 방법으로 사용할 수 있습니다.

- 내장되어 있는 `tf.keras.callbacks` 사용
- 사용자 정의(Custom) callbacks 제작



### 내장 콜백의 종류

`BaseLogger` : 에포크의 평균을 누적하며 콜백

`CSVLogger`

`Callback`

`EarlyStopping`

`History`

`LambdaCallback`

`LearningRateScheduler`

`ModelCheckpoint`

`ProgbarLogger`

`ReduceLROnplateau`

`RemoteMonitor`

`TensorBoard`

`TerminateOnNaN`

[`class BaseLogger`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/BaseLogger?hl=ko): Callback that accumulates epoch averages of metrics.

[`class CSVLogger`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/CSVLogger?hl=ko): Callback that streams epoch results to a csv file.

[`class Callback`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/Callback?hl=ko): Abstract base class used to build new callbacks.

[`class EarlyStopping`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/EarlyStopping?hl=ko): Stop training when a monitored quantity has stopped improving.

[`class History`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/History?hl=ko): Callback that records events into a `History` object.

[`class LambdaCallback`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/LambdaCallback?hl=ko): Callback for creating simple, custom callbacks on-the-fly.

[`class LearningRateScheduler`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/LearningRateScheduler?hl=ko): Learning rate scheduler.

[`class ModelCheckpoint`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/ModelCheckpoint?hl=ko): Save the model after every epoch.

[`class ProgbarLogger`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/ProgbarLogger?hl=ko): Callback that prints metrics to stdout.

[`class ReduceLROnPlateau`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/ReduceLROnPlateau?hl=ko): Reduce learning rate when a metric has stopped improving.

[`class RemoteMonitor`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/RemoteMonitor?hl=ko): Callback used to stream events to a server.

[`class TensorBoard`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/TensorBoard?hl=ko): Enable visualizations for TensorBoard.

[`class TerminateOnNaN`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/TerminateOnNaN?hl=ko): Callback that terminates training when a NaN loss is encountered.



## 내장 콜백 사용

콜백(Callback)은 훈련하는 동안 모델의 동작을 변경하고 확장하기 위해 전달하는 객체입니다. 자신만의 콜백을 작성하거나 다음과 같은 내장 [`tf.keras.callbacks`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks?hl=ko)를 사용할 수 있습니다:

- [`tf.keras.callbacks.ModelCheckpoint`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/ModelCheckpoint?hl=ko): 일정 간격으로 모델의 체크포인트를 저장합니다.
- [`tf.keras.callbacks.LearningRateScheduler`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/LearningRateScheduler?hl=ko): 학습률(learning rate)을 동적으로 변경합니다.
- [`tf.keras.callbacks.EarlyStopping`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/EarlyStopping?hl=ko): 검증(validation) 성능이 향상되지 않으면 훈련을 중지합니다.
- [`tf.keras.callbacks.TensorBoard`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/TensorBoard?hl=ko): [텐서보드](https://tensorflow.org/tensorboard?hl=ko)를 사용하여 모델을 모니터링합니다.

[`tf.keras.callbacks.Callback`](https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/Callback?hl=ko)을 사용하려면 모델의 `fit` 메서드에 전달합니다.

```python
callbacks = [
  # `val_loss`가 2번의 에포크에 걸쳐 향상되지 않으면 훈련을 멈춥니다.
  tf.keras.callbacks.EarlyStopping(patience=2, monitor='val_loss'),
  # `./logs` 디렉토리에 텐서보드 로그를 기록니다.
  tf.keras.callbacks.TensorBoard(log_dir='./logs')
]
model.fit(data, labels, batch_size=32, epochs=5, callbacks=callbacks,
          validation_data=(val_data, val_labels))
```

```python
Train on 1000 samples, validate on 100 samples
Epoch 1/5
1000/1000 [==============================] - 0s 164us/sample - loss: 11.5953 - accuracy: 0.1110 - val_loss: 11.5409 - val_accuracy: 0.1000
Epoch 2/5
1000/1000 [==============================] - 0s 80us/sample - loss: 11.5934 - accuracy: 0.1110 - val_loss: 11.5385 - val_accuracy: 0.0900
Epoch 3/5
1000/1000 [==============================] - 0s 76us/sample - loss: 11.5924 - accuracy: 0.1240 - val_loss: 11.5383 - val_accuracy: 0.1000
Epoch 4/5
1000/1000 [==============================] - 0s 77us/sample - loss: 11.5914 - accuracy: 0.1180 - val_loss: 11.5363 - val_accuracy: 0.0800
Epoch 5/5
1000/1000 [==============================] - 0s 78us/sample - loss: 11.5900 - accuracy: 0.1300 - val_loss: 11.5352 - val_accuracy: 0.0900

<tensorflow.python.keras.callbacks.History at 0x7fca100a0a20>
```





## 사용자 정의 콜백 제작

A custom callback is a powerful tool to customize the behavior of a Keras model during training, evaluation, or inference, including reading/changing the Keras model. Examples include [`tf.keras.callbacks.TensorBoard`](https://www.tensorflow.org/versions/r2.0/api_docs/python/tf/keras/callbacks/TensorBoard)where the training progress and results can be exported and visualized with TensorBoard, or [`tf.keras.callbacks.ModelCheckpoint`](https://www.tensorflow.org/versions/r2.0/api_docs/python/tf/keras/callbacks/ModelCheckpoint) where the model is automatically saved during training, and more. In this guide, you will learn what Keras callback is, when it will be called, what it can do, and how you can build your own. Towards the end of this guide, there will be demos of creating a couple of simple callback applications to get you started on your custom callback.